<template>
  <form :class="['w-form', inline ? 'w-form-inline' : '']">
    <slot></slot>
  </form>
</template>

<script>
const sizesValidator = (val) => ['large', 'medium', 'small', 'mini'].indexOf(val) > -1
export default {
  name: 'WForm',
  data () {
    return {
      validateFields: []
    }
  },
  props: {
    inline: Boolean,
    labelWidth: String,
    labelBold: Boolean,
    labelAlign: {
      type: String,
      default: 'left'
    },
    model: Object,
    rules: Object,
    sizes: {
      type: String,
      default: 'medium',
      validator: val => sizesValidator(val)
    }
  },
  provide () {
    return {
      wForm: this
    }
  },
  methods: {
    validateForm (cb) {
      if (typeof cb !== 'function') {
        console.warn('[Win-Design][form] validateForm cb must be a function!')
        return
      }
      if (!this.model) {
        console.warn('[Win-Design][form] model is required for validate to form!')
        return
      }
      if (!this.rules || !this.validateFields.length) cb(true)
      let valid = true
      let counter = 0
      this.validateFields.forEach(field => {
        field.validateField(null, (msg, invalidField) => {
          msg && (valid = false)
          if (++counter === this.validateFields.length) cb(valid)
        })
      })
    },
    resetFields () {
      if (!this.model) {
        console.warn('[Win-Design][form] model is required for validate to form!')
        return
      }
      this.validateFields.forEach(field => {
        field.resetField()
      })
    }
  },
  created () {
    this.$on('addField', (field) => {
      field && this.validateFields.push(field)
    })
    this.$on('removeField', (field) => {
      let index = this.validateFields.indexOf(field)
      index > -1 && this.validateFields.splice(index, 1)
    })
  }
}
</script>
