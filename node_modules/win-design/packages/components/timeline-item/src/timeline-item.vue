<template>
  <div :class="['w-timeline-item', {
    [`is-${position}`]: position,
    'is-selectable': index !== undefined,
    'is-actived': actived
  }]" @click="handleClick">
    <span class="w-timeline-item__node-wrapper" :style="{
      left: nodePosition
    }">
      <slot name="node">
        <span :class="['w-timeline-item__node', 'is-default']"></span>
      </slot>
    </span>
    <span v-if="timePosition !== 'top'" class="w-timeline-item__content">
      <slot></slot>
    </span>
    <time v-text="time" :class="['w-timeline-item__time', {
      'is-top': timePosition === 'top'
    }]"></time>
    <span v-if="timePosition === 'top'" class="w-timeline-item__content">
      <slot></slot>
    </span>
  </div>
</template>

<script>
import Emitter from '../../../mixins/emitter'
export default {
  name: 'WTimelineItem',
  props: {
    index: {},
    time: String,
    nodeSize: String
  },
  computed: {
    actived () {
      return this.$parent.$data.actived === this.index
    },
    timePosition () {
      return this.$parent.$props.timePosition || 'bottom'
    },
    position () {
      return this.$parent.$props.position || 'left'
    },
    nodePosition () {
      if (!this.nodeSize) return
      let leftPos = `calc(-${this.nodeSize} / 2 - 1px)`
      let rightPos = `calc(100% - ${this.nodeSize} / 2 + 1px)`
      return this.position === 'left' ? leftPos : rightPos
    }
  },
  mixins: [Emitter],
  methods: {
    handleClick () {
      this.index !== undefined && this.dispatchEvent('WTimeline', 'node-click', this.index)
    }
  }
}
</script>
