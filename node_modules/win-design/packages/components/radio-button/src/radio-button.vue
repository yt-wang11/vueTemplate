<template>
  <label :class="['w-radio-button',
    size ? `w-radio-button--${size}` : '', {
    'is-disabled': disabled,
    'is-checked': model !== undefined && model === label,
    'is-border': border
  }]">
    <input v-model="model" class="w-radio-button__native"
      type="radio" :value="label"
      :name="name" :disabled="disabled"
      @change="handleChange" />
    <span class="w-radio-button__label">
      <slot></slot>
      <span v-if="!$slots.default" v-text="label"></span>
    </span>
  </label>
</template>
<script>
import Emitter from '../../../mixins/emitter'
import {findAncestorNode} from '../../../utils/utils'
export default {
  name: 'WRadioButton',
  data () {
    return {}
  },
  inject: {
    wForm: {
      default: ''
    },
    wFormItem: {
      default: ''
    }
  },
  props: {
    border: Boolean,
    disabled: Boolean,
    label: {},
    name: String,
    value: {}
  },
  computed: {
    model: {
      get () {
        return this.isRadioGroup ? this.ancestor.value : this.value
      },
      set (val) {
        this.isRadioGroup ? this.dispatchEvent('WRadioGroup', 'input', val) : this.$emit('input', val)
      }
    },
    ancestor () {
      return findAncestorNode(this.$parent, 'WRadioGroup')
    },
    isRadioGroup () {
      return this.ancestor !== undefined
    },
    size () {
      return this.ancestor && this.ancestor.$props.size || 'medium'
    }
  },
  mixins: [Emitter],
  methods: {
    handleChange () {
      this.$emit('change', this.model)
      this.dispatchEvent('WFormItem', 'w.form.field.change')
      this.isRadioGroup && this.dispatchEvent('WRadioGroup', 'change', this.model)
    }
  }
}
</script>
