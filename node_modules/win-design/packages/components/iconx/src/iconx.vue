<template>
  <svg ref="iconx" class="w-iconx" aria-hidden="true">
    <use :xlink:href="`#${name}${isColored ? `${symbolsLength ? '-' : ''}${symbolsLength}` : ''}`"></use>
  </svg>
</template>

<script>
  export default {
    name: 'WIconx',
    data () {
      return {
        symbolsLength: ''
      }
    },
    props: {
      name: String,
      primaryColor: {
        type: String
      },
      secondColor: {
        type: String
      }
    },
    computed: {
      isColored () {
        return this.primaryColor || this.secondColor
      }
    },
    methods: {
      initSymbols () {
        const svg = document.querySelector('body>svg')
        if (!svg) return
        const symbolsLength = this.symbolsLength = document.querySelectorAll('body>svg symbol').length
        let currentSymbol = document.querySelector(`body>svg symbol#${this.name}`)
        let newSymbol = currentSymbol && currentSymbol.outerHTML.replace(`${this.name}`, `${this.name}-${symbolsLength}`)
        if (!newSymbol) return
        // 自定义svg颜色
        this.primaryColor && (newSymbol = newSymbol.replace(/#0000FF/gi, this.primaryColor))
        this.secondColor && (newSymbol = newSymbol.replace(/#CCCCFF/gi, this.secondColor))
        svg.innerHTML += newSymbol
      }
    },
    mounted () {
      setTimeout(() => {
        this.isColored && this.initSymbols()
      }, 0)
    }
  }
</script>